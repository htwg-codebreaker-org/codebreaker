package de.htwg.codebreaker.controller.commands

import scala.util.Success

import de.htwg.codebreaker.model.server.Server
import de.htwg.codebreaker.model.game.Game
import de.htwg.codebreaker.controller.commands.server.ClaimServerCommand

import org.scalatest.wordspec.AnyWordSpec
import org.scalatest.matchers.should.Matchers


class ClaimServerCommandSpec extends CommandTestBase {

  "ClaimServerCommand" should {

    "claim a server for a player" in {
      val game = baseGame
      val server = game.model.servers.head

      val cmd = ClaimServerCommand(server.name, 0)
      val result = cmd.doStep(game).get

      val updated = result.model.servers.find(_.name == server.name).get
      updated.claimedBy shouldBe Some(0)
    }

    "undo a claimed server" in {
      val game = baseGame
      val server = game.model.servers.head

      val cmd = ClaimServerCommand(server.name, 0)
      val afterDo = cmd.doStep(game).get
      val afterUndo = cmd.undoStep(afterDo).get

      val reverted = afterUndo.model.servers.find(_.name == server.name).get
      reverted.claimedBy shouldBe None
    }
  }
}
